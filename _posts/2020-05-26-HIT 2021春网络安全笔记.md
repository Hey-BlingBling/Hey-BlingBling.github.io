---
layout:     post
title:      "网络安全笔记"
subtitle:   "HIT 2021春"
date:       2020-05-26
author:     Hey-BlingBling
header-img: img/post-web.jpg
catalog: true
tags:

- Blog
- Git
---
# 网络安全期末笔记整理

## 网络安全的概念

### 网络安全的定义

对**信息载体**（处理载体、存储载体、传输载体）和**信息**的处理、传输、存储、访问提供安全保护。

#### 维护信息载体的安全

面对的威胁：物理侵犯、系统漏洞、网络入侵、恶意软件、存储损坏。
应对措施：门控系统、防火墙、防病毒、入侵检测、漏洞扫描、存储备份、日志审计、应急响应、灾难恢复。

#### 维护信息自身的安全

面对的威胁：身份假冒、非法访问、信息泄漏、数据受损、事后否认。
应对措施：身份识别、访问控制、数据加密、数据验证、数字签名、内容过滤、日志审计、应急响应、灾难恢复。

## 网络安全

### 主要目的

对信息载体及其运行提供完整的信息安全保障体系，包括防护、检测、响应、恢复。

### 攻击技术

1. 网络监听：不主动攻击，但在目标主机上设置一个程序去监听目标主机与其他主机的通信数据
2. 网络扫描：利用程序扫描目标主机开放的端口，以发现漏洞，为入侵做准备
3. 网络入侵：探测出漏洞后，入侵到该计算机以获取信息
4. 网络后门：成功入侵后，为了对目标主机进行长期的控制，在目标主机中种植木马等后门
5. 网络隐身：入侵完毕退出计算机时，将自己的入侵痕迹清除，防止被管理员发现

### 防御技术

操作系统的安全配置、加密技术、防火墙技术、入侵检测。

### 网络安全的处理过程

评估阶段、策略制定阶段、实施阶段、培训阶段、审计阶段。

### 攻击技术分析

#### 拒绝服务攻击（DoS）

DoS一般分为两种：

1. 由于错误的配置或软件的弱点导致的；
2. 利用合理的服务请求来占用过多的服务资源，导致服务器超载，无法响应其他请求。

常见的DoS攻击有：

1. FLOOD攻击（PING OF DEATH：发送巨大的PING；SYN FLOOD：发送大量不完全的SYN请求。）
2. SMURF：使用假的IP广播大量IP请求。
3. TearDrop：发送病态的数据分段，严重时破坏IP协议栈。
4. Land：发送源端点地址和目的端点地址相同的IP包。
5. Kiss of Death：将一个IGMP分成11片，逆序发送。

#### 反嗅探技术（Anti-Sniffer）

1. DNS Test
2. Etherping Test
3. ARP Test

原理都相同，即向网络中发送除了MAC地址以外其他内容均正确的数据包，若收到应答，则说明存在嗅探机器。

#### linux 多用户权限

linux中每个用户可以属于多个分组，分组可以是唯一的原始组（一般以自己的用户名命名）和多个附加组（其他分组），每个用户的权限为自身的权限和所在组的权限之和。

每个文件会属于某个用户以及某些分组，对文件（目录或文件）的权限分别有读（r）、写（w）、执行（x），文件的权限设置如下：

1. 所属用户权限（user）
2. 所属组权限（group）
3. 其他用户权限（other）
4. 附加权限，有suid，guid，sticky

![](assets/16202041064062.jpg)

![](assets/16202041174245.jpg)

每个进程生成时会有自己的ID，一般有两类：

1. 真实用户ID（ruid）：不会改变，即登陆用户的ID
2. 有效用户ID（euid）：随着所执行的文件的setuid位的设置与否发生变化
3. 真实组ID（rgid）：用户所属的组的ID，可以添加或删减
4. 有效组ID（egid）：随着执行文件的setgid位的设置与否发生变化

进程能够访问的资源由真实ID和有效ID共同决定。

**若进程执行的文件设置了suid位，则当该进程执行文件时euid会被设置为文件所有者的uid，文件执行结束后切换回自身的uid。guid位同理。**

#### 缓冲区溢出

通过重写堆栈中储存EIP（指向CPU下次要执行的指令的地址）的内容，使程序跳转到特定的位置执行恶意代码。

**堆栈的作用：**

1. 存放主程序返回地址
2. 向子程序传递参数
3. 存储子程序中的变量

**检测是否存在缓冲区攻击的方法：**

1. 检测汇编代码中是否存在大量nop语句
2. 检测执行的代码存在于堆栈中还是代码段中

#### 格式化字符串

由于用户程序员对函数的使用错误，如 printf（str），导致能将用户的输入作为具有控制功能的格式化字符串，最后导致内存泄漏。

## 入侵检测系统（IDS）

### 入侵检测系统简介

#### 定义

入侵检测上用于检测任何损害或企图损害系统的保密性、完整性、可用性行为的一种网络安全技术。

#### 前提

非法行为和合法行为可区分。

#### 需要解决的问题

1. 如何充分并可靠地提取描述行为特征的数据
2. 如何根据特征数据高效并准确地判断行为的性质

### 术语简介

1. 警报：IDS系统向系统操作人员发出入侵正在发生或入侵尝试进行的消息
2. 异常：用一段时间建立一个主机或网络活动的正常轮廓，当用户行为或网络行为与该轮廓的距离超过一定范围后发出警报，称该行为为异常。
3. 网络入侵特征数据库：将网络入侵行为抽象而成的特定的字符集合。
4. 构造数据包
5. 自动响应：一些IDS会对攻击做出防御性反应，如重新配置路由器或防火墙，但这也会被攻击者利用，通过信任地址实施攻击，引起设备重新配置，造成DoS攻击。
6. 蜜罐（Honeypot）：模拟存在漏洞的系统，为攻击者提供攻击目标，从而延缓其对真实目标的攻击。
7. 安全策略：事先定义的正式定档文档声明，定义了哪些服务可以通过监控网段。
8. 感应器：入侵检测构件，从数据源搜集数据。

### 入侵检测的分类（区分优缺点）

基于入侵检测的策略：

1. 滥用检测（Misuse Detection）：对已知的系统缺陷和入侵方法进行检测。**精确度高，但不能检测位置的入侵，可能发生漏报。**
2. 异常检测（Anomaly Detection）：检测系统中是否存在用户的异常行为或对计算机资源的异常使用。**能够防止位置的攻击，但速度较慢，精确度较低。**

基于系统所检测的对象：

1. 基于主机的入侵检测系统：通过监视与分析主机的审计，记录检测入侵。
2. 基于网络的入侵检测系统：通过在共享网段上对通信数据进行侦听采集数据，分析可疑对象。

### 入侵检测系统的功能模块

#### 数据源

提供用于IDS监视的审计数据流。数据源的选择取决于要检测的内容，一般分为两种：

1. 基于主机的数据源

* 操作系统审计记录：由包含在操作系统软件内部的专门的审计子系统产生的事件记录。可靠，难以被修改，但不同软件间可能不兼容，形式或复杂或简缺。
* 系统日志 ：由系统程序产生的用于记录系统或应用程序事件的文件，通常以文本文件存放。更直观、人性化，但以明文存储，易被篡改。

2. 基于网络的数据源：通过网络监听的方式获取到的数据包。

#### 分析引擎

用于对审计的数据进行分析，发现入侵或异常行为。

#### 响应

根据分析引擎的输出结果采取相应的措施

### 入侵检测相关的数学模型

1. 试验模型：某个变量出现的次数超过预定的值，则可能存在异常。如：口令失效次数。
2. 平均值和标准差模型：系统参数与自身的均值和方差的差距超出置信区间，则可能存在异常。如：事件计数器、间隔计数器等。
3. 多变量模型：通过多个随机变量观测系统。
4. 马尔可夫过程模型：将离散的事件（如：审计记录）视作状态变量，用状态转移矩阵刻画状态间的迁移频度。若观察到一个发生概率较低的事件，则可能存在异常。
5. 时序模型：通过间隔计时器和资源计数器两种类型随机变量描述入侵行为，根据一系列时序变量之间的间隔时间和值判断是否发生入侵。若在某个时间内某个序列出现的概率较低，则可能存在异常。这种模型的缺点在于计算开销会很大。

### 基于统计的模型原理

系统针对每个主体定义一个轮廓，通过一系列参数描述该系统，通过定时老化来更新参数。优点是所应用的技术方法在统计学中得到了很好的研究，也具备自学习能力，但事件之间缺乏序列关联能力，系统容易被训练地比较单一。
应用统计技术要求数据来源具有稳定性和相似性，但许多数据往往不能满足这一点。

### 入侵检测系统标准化：通用入侵检测框架（CIDF）

#### CIDF规格文档构成

1. 体系结构
2. 规范语言
3. 内部通讯
4. 程序接口

#### CIDF组件

1. 事件产生器
2. 事件分析器
3. 事件数据库
4. 响应单元

CIDF各个组件之间以通用入侵检测对象（GIDO）的形式交换数据。

#### CIDF互操作

1. 配置互操作：可相互发现并交换数据
2. 语法互操作：可正确识别交换的数据
3. 语义互操作：可正确理解交换的数据

#### CIDF通信层次

1. GIDO层：传输信息格式化
2. 消息层：对消息进行加密认证，并可靠地将其从源传输到目的
3. 传输层：不属于CIDF规范，可采用现有的多种传输机制实现

### Snort系统

#### Snort简介

一个使用C语言编写的开放源代码软件，是一个跨平台、轻量级的网络入侵检测软件，基于libpcap的数据包嗅探器和日志记录工具。采用**基于规则的网络信息搜索机制**，对数据包进行内容的模式匹配，从中发现入侵和探测行为。

#### Snort系统组成

1. 数据包捕获和解析子系统
2. 检测引擎
3. 日志和报警子系统

#### Snort配置

1. 设置网络变量
2. 配置预处理器
3. 配置输出插件
4. 配置所使用的规则集

#### 编写Snort规则

规则头（规则行为、协议、源和目的IP、子网掩码、源和目的端口） + 规则选项（报警信息和异常包信息）

Snort可分析的协议有TCP、UDP、ICMP。

### 自治代理入侵检测系统（AAFID）

大规模网络环境中的入侵检测，**若基于网络进行**，会因为数据量过大，导致集中式的中央处理无法胜任；**若基于主机进行**，会因为记录格式异构，检测代价太大，且实时入侵检测会极大影响系统的性能，故提出了**AAFID**。
AAFID系统分布在网络中任意数目的主机上，每个主机上有一定数量的**Agent（代理）**，监视该机器上的事件；每台主机上有唯一的一个**Transceivcer（收发器）**，该机器上的所有Agent向该收发器报告发生的事件，收发器能根据Agent收取到的数据检测该主机的入侵或可以行为、对数据进行精简，然后向**Monitor**（监视器）报告结果；每个Monitor可以访问多个收发器，进行更高级的关联以及检测涉及几台主机的入侵。
AAFID组件的协作机制：

1. 统一的数据交换格式
2. 统一的通讯机制

### 入侵检测系统应用中的问题

目前的入侵检测系统对于已知的攻击手段检测效果很好，但对于新的攻击手段以及**隐秘攻击**的检测率都很低。
原因：**传统的IDS采用的简单的模式匹配技术，只能根据固定的规则和固定的匹配模式进行检测**

### IDS在安全体系结构层次中的两种观点

1. 检测与保护需要在基本不交叉的一个独立的层次上，这类IDS易实现。但由于两个层次没有交叉，所以IDS对于协议的理解与OS和应用程序并不完全一致，隐含了误报和漏报的可能。
2. 检测与保护应该紧密结合，在实际中通常以内核补丁或驱动程序的形式出现，这种方法往往能以非常简介的方式达到准确监测的目的。

### 入侵响应

入侵响应分为以下两类：

1. 主动响应：用自动的或用户指定的方式，阻断攻击过程，可分为三类：

* 针对入侵者采取相应的措施
* 修正系统
* 收集更详细的信息

2. 被动响应：只记录问题和报告问题。

**联动响应：一种主动响应方式，指IDS检测到需要阻断的入侵行为时，立刻迅速启动联动机制，自动通知防火墙或其他安全控制设备对攻击源进行封堵，达到整体安全控制的效果。**

### 入侵检测系统的测试评估

#### 步骤

1. 创建、选择一些测试工具或测试脚本
2. 确定计算环境所要求的条件
3. 配置运行入侵检测系统
4. 运行测试工具或测试脚本
5. 测试结果的分析评价

#### 软件测试

一般包括功能测试、性能测试和可用性测试。

#### 逃避检测常见手段

1. 慢扫描
2. IP分片
3. 插入
4. 逃避
5. 分布式拒绝服务攻击（DDoS）
6. 模式变种（如：URL攻击）

#### 测试数据的生成

要求：

1. 数据生成能自动完成
2. 数据有一定的重复性
3. 数据生成要有一定的健壮性

数据一般分为训练数据和实际测试数据。

#### 网络用户行为的仿真

主要分为：

1. 网络流量仿真
2. 主机正常使用仿真
3. 攻击仿真

## 高性能报文获取和发送平台

### 报文捕获技术简介

将某个网络设备所能接收到的所有数据报文完整地收集起来，然后对其进行分析、过滤处理后，送往上层做进一步的应用。

### 应用需求

1. 面向宽带网络的入侵检测系统
2. 宽带网络防火墙
3. 机群高效通信系统
4. 高速路由器

### 报文收集的两种方式

1. 使用能够采集数据报文的**专用数据采集卡**，对相应的设备进行监测与采集。
2. 利用**以太网卡的混杂模式**收集局域网内的报文。

### 影响捕包性能的因素

1. 系统调用：用户程序与I/O设备交流必须通过系统调用，但这个过程需要进行安全性检查和上下文切换等过程，耗费大量的资源和时间，是一个沉重的负担。
2. **数据包在用户态和内核态之间的拷贝**
3. 计算校验和
4. 应用程序的内存空间和物理内存空间之间的映射
5. 填充协议头和分片重组
6. 网卡的每包中断方式

### 提高捕包效率的方式

1. 减少内存拷贝的次数，节省大部分的CPU时间（**零拷贝思想**）
2. 改进中断方式，减少不必要的CPU周期

## 入侵容忍

### 定义

一个具有容侵能力的系统在受到攻击、甚至系统的某些部分已经收到破坏、被恶意攻击者操纵时，仍然能够对合法用户继续提供服务或降级服务，保证系统数据的机密性和完整性，并且具备自诊断、自恢复以及重新构造的能力。

### 容侵与容错

容错多指系统能够容忍**意外错误**的能力，这类错误一般是非人为的不可预知的错误。
而容侵是指系统能够容忍**主动入侵**的能力，这类错误一般是有意的、人为的。

### 分类

1. **基于攻击屏蔽**的入侵容忍：设计系统时就考虑到了入侵，能对一般的可以预见的攻击进行屏蔽，使系统表现正常。
2. **基于攻击响应**的入侵容忍：很大程度上依赖于入侵检测系统

### 冗余

入侵容忍建立在**冗余**的基础上，没有冗余，就没有容错。
入侵容忍系统中一般采用多样化的冗余技术，结合硬件冗余（选用不同的硬件平台）、软件冗余（选用不同的操作系统和应用软件）等多种冗余技术避免入侵攻击。

### 相关技术

1. 多样化的冗余技术
2. 拜占庭一致性协商技术：若要容忍t个叛国将军，则将军总数至少为3t+1
3. 系统重构技术
4. 门限密码技术：秘密共享
5. ...

## 运行安全--防火墙

### 基本概念

1. 堡垒主机：是一台完全暴露给外网的主机，故需要配置安全防范措施，能够为内外网络之间的通信提供了一个阻塞点，若没有堡垒主机，内外网络之间将不能互相访问
2. 双宿主机：有两个网络接口的计算机系统，分别与内外网相接
3. DMZ（非军事区或停火区）：在内部网和外部网之间增加的一个子网

### 防火墙的局限性

1. 为了提高安全性，会关闭一些有用但存在缺陷的网络服务，为用户带来不便
2. 无法防范来自网络内部的攻击以及不经过防火墙的攻击
3. 防火墙对用户不透明，会带来传输延迟、瓶颈问题、单点失效等问题
4. 不能完全防范所有的病毒，难以应对互联网上的各类威胁

### 防火墙模型分类

#### 包过滤防火墙

对接受到的每个数据包进行检查，根据制定好的过滤规则，决定转发或丢弃，一般是双向配置。
实现简单，**往往可以使用一台路由器实现**；但维护困难，不支持用户鉴别。

#### 双宿/多宿主机模式

拥有两个或多个连接到不同网络上的网络接口的防火墙，多块网卡个字与受保护网和外网相连。

#### 屏蔽主机模式/单宿主机模式

堡垒主机安装在内部网络上，通常在路由器上设立过滤规则，使堡垒主机成为外部网络唯一可直接到达的主机。

#### 屏蔽子网模式

堡垒主机、Web服务器、Mail服务器等公用服务器均防止在非军事区网络中，内部网络和外部网络均可访问屏蔽子网，但相互之间不能通信。
堡垒主机运行各种代理服务，可以更有效地提供服务。

### 防火墙的相关技术

#### 静态包过滤

根据流经该设备的数据包地址信息决定是否可以通过，只根据IP数据包的信息进行过滤。
在IP层进行数据包过滤。

#### 动态包过滤

相较于静态包过滤，还需要结合身份认证，根据建立的连接的信息验证进入的通信是否合法，并针对其进行规则的动态增加与删减。
在IP层、TCP层、应用层进行数据包过滤。

#### 应用级网关

可以实施更细粒度的访问控制，对于每一类应用，都需要有一个专门的代理，也称为代理服务器。
在应用层进行数据包过滤。

#### 电路级防火墙

拓扑结构与应用级网关相同。电路级防火墙接受客户端连接请求，代理客户端完成网络连接，在客户和服务器间中转数据。典型的例子为：SOCKS协议。是一个**通用的代理服务器**。
在TCP层进行数据包过滤。

#### 混合型防火墙

结合之前的所有防火墙技术进行使用。

#### 网络地址翻译技术（NAT）

NAT技术的优点：

1. 保护内网结构
2. 解决IP地址空间不足的问题
3. 负载均衡
4. 地址交迭

可分为静态NAT和动态NAT。

#### 虚拟专用网（VPN）

### 防火墙实现方法

1. 硬件防火墙
2. 基于PC框架、使用经过定制的通用操作系统的防火墙。

### 其他防火墙技术

1. 热恢复策略
2. 流量控制
3. IP与MAC绑定
4. 用户身份鉴别
5. 负载均衡
6. 内容安全
7. 防火墙的免疫设计

## 身份认证

### 定义

指计算机及网络系统确认操作者身份的过程。

### 三种认证的原理

1. What you know?
2. What you have?
3. Who you are?

### 身份认证技术分类

1. 用户名/密码认证
2. IC卡认证
3. 动态口令
4. 生物特征识别
5. USB Key认证

### 口令技术的发展

1. 早期采用的明文口令：数据库中直接存储口令，传输过程中加密
2. 延伸后的口令：对口令进行某种运算，再把运算后的值存储在系统中，缺点是不能防止重放攻击
3. 增加随机性：质询口令，通过系统向用户返回一个随机数的方式防止重放攻击。一般有两种方案：

* 加密解密模型：用户和认证系统采用相同的密码函数，用户端使用口令摘要作为对称加密的密钥对质询加密，将加密后的结果返回给认证系统。系统通过将数据库中用户密码的摘要拷贝与生产的质询采用相同的算法加密，再与用户传输的加密结果进行对比得出结果。
* 把质询和用户的口令结合起来再产生摘要返回给系统。

4. 认证令牌一般分为：

* 质询响应令牌
* 事件令牌

5. 在令牌中引入PIN，使单因素认证变为双因素认证。

### Kerberos系统

## PKI

### PKI系统的主要组成

1. 认证机构CA：证书的签发机构
2. 证书库：证书的集中存放地点
3. 密钥备份和恢复系统：备份用户的解密密钥，以便在丢失后恢复
4. 证书撤销处理系统：根据需要作废证书
5. PKI应用程序接口：为各种应用提供访问PKI的方式

### CA

#### CA的定义

是一个权威的、可信任的、公正的第三方机构，负责证书的产生、管理、存档、发放、作废管理等，是PKI的核心。

##### CA的任务

1. 验证并标识证书申请者的身份
2. 审批、发放、更新、验证证书
3. 证书资料信息的管理
4. 产生和发布撤销证书列表
5. 证书、密钥、历史数据的归档

#### CA的职责

1. 确保CA用于签名证书的非对称密钥的质量
2. 确保整个签证过程的安全性，确保签名密钥的安全性
3. 确保证书主体标识的唯一性

### 证书

#### 定义

是公钥体制的一种密钥管理媒介，可以证明主体身份以及其公钥的合法性。证书中含有主体的身份和公钥，并使用CA的私钥签名。

#### 数字证书包含的内容

1. 主体
2. 公钥
3. 颁发者
4. 序列号
5. 起始日期和终止日期
6. 用途
7. 数字签名（用颁发者的私钥生成的颁发者的数字签名）

#### 证书的颁发

#### 证书的更新

##### 更新的原因

1. 密钥到期
2. 证书到期
3. 证书中已经证明的属性发生改变

##### 更新的方式

实体证书的更新只需要使用旧的密钥和证书做认证进行更新即可。
CA证书的更新影响范围较大，一般采用以下四类证书完成CA证书的平滑更新：

1. 旧密钥签名旧证书：原始证书
2. 新密钥签名旧证书：CA新私钥签名CA旧公钥（用之前的密钥证明新产生的公钥。有效期：从新密钥产生开始，到所有证书依赖方承认该新密钥）
3. 旧密钥签名新证书：CA旧私钥签名CA新公钥（实现新密钥的平滑转换，该阶段为证书交迭期，新、旧证书均可使用。有效期：从先前的密钥对产生开始，到旧密钥签名旧证书过期时结束）
4. 新密钥签名新证书：CA新私钥签名CA新公钥

#### 证书的撤销

##### 撤销的原因

1. 私钥泄漏
2. 身份改变
3. 证书持有者死亡
4. 证书主体未履行相关义务
5. 主体身份伪造
6. 涉及犯罪

##### 撤销机制

CA会公布撤销证书列表CRL，其中包含证书序列号、作用日期、撤销原因等。CRL会由CA私钥签名

#### 证书的认证

1. 验证签名者
2. 验证有效期
3. 验证证书的预期用途是否符合规范
4. 验证证书是否被撤销

#### 使用证书的应用程序

##### 安全套接字层SSL

将Web浏览器的数据定向到Web服务器的另外一个不同的端口上，会话中的所有信息都被加密。需要使用证书确认身份，认证方法如下：

1. 服务器端认证：服务器端发送一个证书给Web浏览器供其认证
2. 客户端认证：Web服务器请求用户的证书进行认证

##### 安全的电子邮件

发送者先获取接收者的证书，验证成功后使用其中的公钥加密邮件发送。

##### 虚拟专用网

可以达到"像私有网络一样使用公共网络"，但交换的信息必须加密，信息交换双方需要在通信前确认对方的身份。每个终端实体向对方提交自己的证书并证明自己确实拥有相应的私钥。证书中包含有作为主体标识的网络地址。

#### 证书的分发

##### 在协议内部分发

##### 使用库分发

### PKI所依赖的两个概念

1. 身份可靠：由权威、可靠的第三方颁发
2. 身份与公钥绑定：CA私钥的安全性问题

## IPSec

### 定义

能够确保端到端的IP层通信安全的协议族。

### 协议组成

1. 协商阶段：通信双方互相确认身份，并根据安全策略使用的加密、认证算法生成会话密钥。
2. 数据交互阶段：通信双方利用协商好的算法和密钥对数据进行安全处理。

### 安全策略（三个核心部分组成）

#### SPD（安全策略库）

安全策略通常以SPD的形式表现，库中的每条记录对应一个安全策略。对于每个检测的报文，会有**丢弃、绕过、应用IPSEC**三种处理方式。
SPD是有序的

#### SA（安全关联）

SA是IP鉴别和保密机制中最关键的概念，一个关联就是发送着与接收者之间的一个**单向**关系，是与给定的一个网络连接或一组网络连接相关联的安全信息参数的集合。若需要一个对等关系，则需要两个CA。
每个CA由三个参数标识：

1. 安全参数索引SPI
2. 对方的IP
3. 安全协议标识：标识该SA是一个AH型SA还是ESP型SA

#### SAD（安全关联库）

为进出的数据报维护一个活动的SA列表，其中的记录是无序的。

### IPSEC中的三个重要协议

#### AH协议

提供数据完整性验证、数据源身份认证、防重放攻击三类服务。

#### ESP协议

在AH的基础上，还可以提供对数据的加密服务。
**注：AH和ESP可以单独使用，也可以嵌套使用。**
**AH在传输模式和隧道模式下均与NAT存在冲突，因为AH验证的范围包含了源IP和目的IP，这些内容在NAT时会被改变。而ESP不验证IP头部，故与NAT不存在冲突。**

#### IKE协议

是一种混合型密钥交换协议，分为两个阶段进行：主模式/积极模式/野蛮模式（建立IKE SA，建立验证过的密钥）、快速模式（为IPSEC协商安全服务）。

### IPSEC的两种模式

#### 传输模式

保护的目标是**IP包的载荷**，通常只用于两台主机间的通信。

#### 隧道模式

保护的目标是**整个IP包**，通常只要IPSEC双方有一方是安全网关或路由器，就需要使用隧道模式。

## 协议安全

### ARP协议的缺陷

#### 假冒ARP应答

A未向B发送ARP请求包，C冒充B向A发送ARP应答包，修改A缓存中关于B的地址信息

#### 点对点的假冒查询

A向B发送ARP请求后，B向A返回ARP应答包，之后A和B可进行点对点通信。C在此时冒充A向B发送单播ARP查询包，修改B缓存中关于A的地址信息

#### 自动定时ARP欺骗

由于每隔一段时间都会进行缓存中MAC地址的更新，故可以在MAC更新前再次发送AR欺骗包，延长欺骗时间

#### 通过对网关的干扰

ARP欺骗包中的IP为网关IP，这导致之后的ARP查询包中源地址和目的地址一样，这种ARP查询包为通知查询包，这样会导致所有主机都不能访问该局域网中的所有IP

#### 推迟ARP解析时间

主机能很快意识到在与错误的MAC通信，进而重新发送ARP查询，故可以发送存在但错误的MAC地址，延迟主机重新进行ARP解析时间

#### 交换网络监听（ARP欺骗和端口滥用）

### TCP/IP协议缺陷

1. IP的一个无连接、无可靠保证的网络协议，传输的数据报既不能保证送达也不能保证顺序
2. 只依靠源地址和目的地址，不能保证发送方和接收方身份的合法性
3. 缺乏对传输数据的完整性和机密性的保护机制

#### IP欺骗/源地址欺骗

攻击者冒充某个第三方主机的IP地址向被攻击主机发起攻击。前提为：被冒充主机与被攻击的主机有信任关系。一般需要两个步骤：

1. 压制被冒充的主机（使其瘫痪）
2. 模仿被冒充的主机与目标主机行通信

#### 源路由攻击

一般情况下，IP数据包的传输路径由路由器根据当前的网络状况和IP包中的目的IP地址进行随机的选择。但有时候为了达到某种目的（如希望避开某些不稳定的路径），发送方可以事先指定一个传输路径，所有的应答包也会在这条路径上传输。利用这一点，攻击者可以让被攻击的主机将数据包传输到指定的节点，步骤如下：
假设：主机A是攻击的目标主机，主机B是主机A的信任主机，主机X是攻击主机，并且攻击者可以控制离其最近的路由器G。

1. 攻击者登陆路由器G，并在其中添加路由信息，使所有发往主机B的数据包都转发到攻击主机X所在的网络
2. 攻击者冒充主机B向主机A发送数据包，即在IP包首部的源IP地址中填上主机B的IP地址，并在可选项中填写好精心设计的传输路径，使往返数据包都会经过路由器G
3. 路由器G在收到目的地址为主机B的数据包后，根据被更改过的路由信息，将数据包转发到攻击主机X所在的网络

#### SYN FLOOD

### 应用层协议缺陷（以DNS为主介绍）

#### DNS欺骗分类

由于DNS解析可分为正向解析和反向解析，故DNS欺骗也可分为正向欺骗和反向欺骗：

1. 正向：伪造一个DNS正向解析报文可以将被攻击的主机引向一个非法的IP
2. 反向：可用于隐藏IP

#### DNS安全威胁分类

1. 协议脆弱性：由系统在设计初期对假设条件考虑不充分或之后环境变化导致，难以在根源上修正
2. 实现脆弱性：由于编码阶段安全性防范等级较低以及测试程序不全面，导致在某种特定条件下程序执行异常和错误
3. 操作脆弱性：人为的操作或配置导致的安全隐患

以上三点造成了DNS的系统脆弱性。

#### 常见的DNS攻击

##### 域名欺骗/DNS欺骗

域名解析系统接收或使用来自未授权主机的不正确信息。
常见的有**缓存中毒**和**事件ID欺骗**。

##### DoS攻击（拒绝服务攻击）

利用DNS查询过程中响应报文的尺寸远大于请求报文的尺寸的原理，可以有效对DNS服务器实施DoS攻击。

##### 恶意网址重定向（网络钓鱼）

##### Bind漏洞攻击

##### 域名注册攻击

对域名注册管理公司的注册域名记录进行非法的改变，使之指向其他的Web站点。攻击者可以通过利用域名注册时限，即原域名拥有者对其域名失去拥有权的间隙，购买到期的域名，将其占为己有；或通过冒充原域名拥有者，以电子邮件等方式向域名注册管理公司提出修改注册域名记录，将域名重定向到另一个Web站点。
类似的攻击还有：利用用户习惯性错误拼写、域名之间的相似性欺骗用。

##### 信息泄漏

DNA区域传送是一种DNS服务器的冗余机制，通过这种机制，辅DNS服务器能够从其主DNS服务器更新自己的数据，以便主DNS服务器失效时，辅DNS服务器可以接替其工作。一般DNS区域传送操作只对辅DNS服务器开放，但可能由于系统管理员的错误配置，导致任意主机均可以请求主DNS服务器提供一个区域数据的拷贝，最终导致信息泄漏。

### WEB安全

#### Cookie的脆弱性

Cookie中往往会包含一些敏感数据，这会留下许多安全隐患。

#### SQL注入漏洞

即通过SQL语句恶意调用后台数据库。任何依赖于解释执行的Web应用都有被注入漏洞攻击的危险。

##### 原理

利用Web程序对特殊字符串过滤不完全的缺陷，使用了用户动态输入的内容来拼接SQL语句，造成对数据库的非法访问。

##### 防护方式

1. 字符串长度验证、特殊符号检查、参数格式化
2. 拒绝使用动态拼接SQL
3. 严格管理数据库权限，永远不能将管理员权限赋予一个数据库连接
4. 机密信息加密存放，不能明文存放
5. 做好XSS跨站攻击的防护

#### 跨站脚本攻击（XSS）

攻击者利用Web程序对用户输入过滤不足的缺陷，将恶意代码（包括HTML代码和客户端脚本）注入到其他用户的浏览器执行，从而窃取用户敏感信息、伪造用户身份。
任何需要用户提交数据的地方，都可能成为跨站脚本攻击的目标。

##### XSS攻击的前提

1. Web程序要接受用户的输入
2. Web程序必须重新显示用户输入的内容

##### XSS的分类

###### 反射式XSS/非持久型XSS

攻击者通过特定的方式诱惑受害者访问特定的恶意URL，通过这样的方式使恶意代码在目标主机的浏览器上执行。
数据流向：浏览器 -> 后端 -> 浏览器

###### 储存式XSS/持久型XSS

会将恶意代码上传到服务器中（存储到数据库中），只要被攻击者浏览包含恶意代码的页面，恶意代码就会执行。
数据流向：浏览器 -> 后端 -> 数据库 -> 后端 -> 浏览器

###### DOM式XSS

一种不经过后端的攻击方式，DOM XSS漏洞是基于文档对象模型（Document Object Model,DOM）的一种漏洞，通过url传入参数去控制触发的。
数据流向：URL -> 浏览器

##### 防范方式

1. 对输入进行过滤
2. 对用户进行培训
3. 防止访问已知的恶意网址
4. 执行手工或自动代码扫描

## 云数据的安全

在云数据信息存储中，用户的所有信息都会存储在云端，而用户并不能完全信任服务商，针对这类问题，提出了一系列云安全隐私保护技术。

### 代理重加密：支持数据共享

代理重加密是密文间的一种密钥转换机制，在代理重加密中，一个半可信代理人通过**代理授权人产生的转换密钥**``R_K``把用授权人Alice的公钥``P_A``加密的密文转化为用被授权人Bob的公钥``P_B``加密的密文，在这个过程中，半可信代理人得不到数据的明文信息，从而降低了数据泄露风险。
根据代理转换密钥的性质，可将代理重加密分为：

1. 双向代理重加密
2. 单向代理重加密

根据密文能否被多次转换，可将代理重加密分为：

1. 多跳代理重加密
2. 单跳代理重加密

代理重加密的方案有：

1. 基于身份的代理重加密
2. 无证书代理重加密
3. 基于时间的代理重加密

### 查询加密

基本思想为，通过构造安全索引，利用查询陷门来高效地支持密文搜索。

### 同态加密

一种支持直接在密文上进行计算的特殊加密体系，它使得对密文进行的代数运算得到的结果与对明文进行等价运算后再加密得到的结果一致。

### 云数据访问控制

#### 基于选择加密的访问控制

将加密机制与访问控制策略相结合，通过密钥的分发管理来控制数据的授权访问。核心在于如何有效地将访问控制策略转换为等效的加密策略，以及如何安全有效地产生和分发密钥。
**密钥派生原理**：一个密钥可以通过另一个密钥和一些公开的信息计算产生。
密钥派生可以通过密钥派生图来定义实现。

#### 基于属性加密的访问控制

##### 定义

属性加密：以用户的属性为公钥，通过引入访问结构将密文或用户私钥与属性相关联。能够形成更加细粒度的访问授权。

##### **基于ABE（Attribute-Based Encryption）的访问控制系统**

###### 组成

可信机构、数据发布者（加密者）、多个数据使用者（解密者）。

###### 原理

系统在生成密钥或产生密文时可以根据一个访问结构来产生，使得只有满足指定属性条件的用户才能解密密文，从而实现数据的授权访问。

### 云数据完整性

#### 数据持有证明（Provable Data Possession,PDP）

一种**基于挑战-应答协议的概率性远程完整性验证**。用户在上传存储到云服务器前为数据块生成验证标签，之后可以通过一个挑战-应答协议，根据云服务器生成的验证证据和存储于本地的验证标签来验证数据是否被修改。

#### 数据可恢复证明（Proof of Retrievability,PoR）

一种**基于挑战-应答协议的概率性远程完整性验证**。采用了纠错编码技术，保证被丢失或被破坏的数据的可恢复性。

### 云数据的可信删除

#### 基于密码技术的可信删除方法

用某种措施"破坏"原始数据，使其不能被恢复，从而达到删除的效果。
